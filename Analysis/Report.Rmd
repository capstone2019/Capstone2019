---
title: "High-Level Med Analysis"
author: "Yasmine, Anni, Vanessa, Katie"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(PerformanceAnalytics) #find correlation chart.Correlation()
library(ggplot2)
library(knitr)
library(plotly)

#Read in the data()
med <- read.csv('~/Desktop/Demographic/claims_med_interns_2016-2018.csv')
pharm <- read.csv('~/Desktop/Demographic/claims_pharm_capstone_2016-2018.csv')

#med data analysis
med_revise <- med %>% select("Claim.ID", "Member.Gender", "Age", "Zip..5.digit.", 
                         "Primary.ICD.Diagnosis.Code", "Primary.ICD.Rollup",
                         "Incurred.Year", "CCHG.Label")

```

## Gender and Age
This graph shows the gender distribution in the current data.The red color in the graph represents the number of female and the blue color represents the number of male workers.

As you can see, __the ratio of female workers to male workers is roughly 7:1__.

```{r, echo=FALSE}
#Gender Distribution
ggplot(med_revise) + 
  geom_bar(aes(x=Member.Gender, color=Member.Gender, fill = Member.Gender)) +
  labs(title = "Gender Distribution", x = "Gender", y = "Count") +
  scale_y_continuous(name="Fluorescent intensity/arbitrary units", labels = scales::comma) +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))
```

The plot below shows the age distribution of the workers by gender. Red represents female workers blue represents the male workeres. The plot shows that __more than 50% of the workers from 2016 - 2018 are between age 50 and 70__. This distribution applies to both female and male workers.

```{r, echo=FALSE, message=FALSE}
#Age Distribution
ggplot(med_revise) + 
  geom_histogram(aes(x=Age, color=Member.Gender), fill="white", stat="count") +
  labs(title = "Age Distribution", x = "Age", y = "Count") +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))
```

We can display distribution of age over the years 2016-2018. A slight right skew is shown in age.

```{r, echo=FALSE}
#Age Distribution by Year
year_one_data <- med_revise %>% 
  filter(Incurred.Year == 2016) %>%  
  select(Age) %>% 
  group_by(Age) %>% 
  summarise(num = n())

colnames(year_one_data) <- c("2016", "num")

year_two_data <- med_revise %>% 
  filter(Incurred.Year == 2017) %>%  
  select(Age) %>% 
  group_by(Age) %>% 
  summarise(num = n())

colnames(year_two_data) <- c("2017", "num")

year_three_data <- med_revise %>% 
  filter(Incurred.Year == 2018) %>% 
  select(Age) %>% 
  group_by(Age) %>% 
  summarise(num = n())

colnames(year_three_data) <- c("2018", "num")

# ggplot() + 
#   geom_line(data = year_one_data, aes(x = `2016`, y = num), color = "blue") +
#   geom_line(data = year_two_data, aes(x = `2017`, y = num), color = "red") +
#   geom_line(data = year_three_data, aes(x = `2018`, y = num), color = "black") +
#   labs(title = "Age Distribution by Year", x = "Age", y = "Number of Claims")

ggplot(med_revise) + 
  geom_line(aes(x=Age), stat="count") +
  labs(title = "Age Distribution by Year", x = "Age", y = "Count") +
  facet_wrap(~Incurred.Year)
```


## Looking into Chronic Disease

Let's take a look at the 10 most common ICD rollups. We currently only include primary ICD rollups. We aim to include 2nd, 3rd, and 4th rollups if applicable in order to analyze all things happening in the claim.

```{r, echo=FALSE}
# Icd rollup distribution
icd <- med_revise %>% 
  group_by(Primary.ICD.Rollup) %>% 
  distinct(Claim.ID) %>% 
  summarize(count=n()) %>% 
  arrange(desc(count))

ggplot(data=icd[1:10,], aes(x=reorder(Primary.ICD.Rollup, count), y=count)) +
  geom_bar(position="dodge",stat="identity", fill = 'pink') + 
  coord_flip() +
  labs(title = "Most Common ICD", x = "ICD Rollups")

```