---
title: "2016 - 2018 Data Analysis Report"
author: "Team Empower"
output: html_document
---

```{r setup, include=FALSE}
library("dplyr")
library('PerformanceAnalytics') #find correlation chart.Correlation()
library("ggplot2")
library("knitr")

#Read in the data()
med <- read.csv('~/Desktop/Demographic/claims_med_interns_2016-2018.csv')
pharm <- read.csv('~/Desktop/Demographic/claims_pharm_capstone_2016-2018.csv')

#med data analysis
med_revise <- med %>% select("Claim.ID", "Member.Gender", "Age", "Zip..5.digit.", 
                         "Primary.ICD.Diagnosis.Code", "Primary.ICD.Rollup",
                         "Incurred.Year", "CCHG.Label")
```

## Med Data Analysis
This graph shows the gender distribution in the current data.The red color in the graph represents the number of female and the blue color represents the number of male workers.
As you can see, __the ratio of female workers to male workers is roughly 7:1__.
```{r, echo=FALSE}
#Gender Distribution
ggplot(med_revise) + 
  geom_bar(aes(x=Member.Gender, color=Member.Gender, fill = Member.Gender)) +
  labs(title = "Gender Distribution", x = "Gender", y = "Count") +
  scale_y_continuous(name="Fluorescent intensity/arbitrary units", labels = scales::comma) +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))
```

This graph shows the age distribution of the workers by gender. The red color represents female workers and the blue color represents the male workeres. 
The graph shows that __more than 50% of the workers from 2016 - 2018 are between age 50 and 70__. This distribution applies to both female and male workers.
```{r, echo=FALSE, message=FALSE}
#Age Distribution
ggplot(med_revise) + 
  geom_histogram(aes(x=Age, color=Member.Gender), fill="white", stat="count") +
  labs(title = "Age Distribution", x = "Age", y = "Count") +
  theme(axis.title.y = element_text(margin = margin(t = 0, r = 20, b = 0, l = 0)))
```

```{r, echo=FALSE}
#Age Distribution by Year
year_one_data <- med_revise %>% 
  filter(Incurred.Year == 2016) %>%  
  select(Age) %>% 
  group_by(Age) %>% 
  summarise(num = n())
colnames(year_one_data) <- c("2016", "num")
year_two_data <- med_revise %>% 
  filter(Incurred.Year == 2017) %>%  
  select(Age) %>% 
  group_by(Age) %>% 
  summarise(num = n())
colnames(year_two_data) <- c("2017", "num")
year_three_data <- med_revise %>% 
  filter(Incurred.Year == 2018) %>% 
  select(Age) %>% 
  group_by(Age) %>% 
  summarise(num = n())
colnames(year_three_data) <- c("2018", "num")

age <- med_revise %>% 
  group_by(Incurred.Year)

# ggplot(age, aes(x=Incurred.Year, y=Age, group=Incurred.Year) + 
#   geom_boxplot()


ggplot(med_revise) + 
  geom_line(aes(x=Age), stat="count") +
  labs(title = "Age Distribution", x = "Age", y = "Count") +
  facet_wrap(~Incurred.Year)
```

```{r, echo=FALSE}
# Icd rollup distribution
icd <- med_revise %>% 
  group_by(Primary.ICD.Rollup) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(desc(n))
kable(icd[1:10,])
```

```{r, echo=FALSE}
# year counts
year <- med_revise %>% 
  group_by(Incurred.Year) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(desc(n))

ggplot(year) + 
  geom_bar(aes(x=Incurred.Year, y=n), stat="identity") +
  labs(title = "Year Counts", x = "Year", y = "Count")
```

```{r, echo=FALSE}
employee_type <- pharm %>% 
  group_by(Employee.Type) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(desc(n))

ggplot(employee_type) + 
  geom_bar(aes(x=Employee.Type, y=n), stat = "identity") +
  labs(title = "Employee Type Count", x = "Employee Type", y = "Count")
```

```{r, echo=FALSE}
#Chronic disease by gender
med_gender <- med_revise %>% 
  group_by(CCHG.Label, Member.Gender) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(CCHG.Label)

top_10 <- med_gender %>% arrange(desc(n))
kable(top_10[1:10,])
```

```{r, echo=FALSE}
#Chronic disease by age
med_age <- med_revise %>% 
  group_by(CCHG.Label, Age) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(CCHG.Label)

top_10 <- med_age %>% arrange(desc(n))
kable(top_10[1:10,])
```

```{r, echo=FALSE}
#Chronic disease by zipcode
med_zip <- med_revise %>% 
  group_by(CCHG.Label, Zip..5.digit.) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(CCHG.Label)

top_10 <- med_zip %>% arrange(desc(n))
kable(top_10[1:10,])
```

```{r, echo=FALSE}
#plot of 2016 Chronic disease by gender and age
med_analysis_2016 <- med_revise %>% 
  filter(Incurred.Year == 2016) %>% 
  group_by(CCHG.Label, Age, Member.Gender) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(CCHG.Label) %>% 
  ggplot() +
  geom_point(mapping = aes(x = Age, y = n, color = Member.Gender)) +
  facet_wrap(~CCHG.Label)

med_analysis_2016
```

```{r, echo=FALSE}
#plot of 2017 Chronic disease by gender and age
med_analysis_2017 <- med_revise %>% 
  filter(Incurred.Year == 2017) %>% 
  group_by(CCHG.Label, Age, Member.Gender) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(CCHG.Label) %>% 
  ggplot() +
  geom_point(mapping = aes(x = Age, y = n, color = Member.Gender)) +
  facet_wrap(~CCHG.Label)
med_analysis_2017
```

```{r, echo=FALSE}
#plot of 2018 Chronic disease by gender and age
med_analysis_2018 <- med_revise %>% 
  filter(Incurred.Year == 2018) %>% 
  group_by(CCHG.Label, Age, Member.Gender) %>% 
  distinct(Claim.ID) %>% 
  summarize(n=n()) %>% 
  arrange(CCHG.Label) %>% 
  ggplot() +
  geom_point(mapping = aes(x = Age, y = n, color = Member.Gender)) +
  facet_wrap(~CCHG.Label)
med_analysis_2018
```
