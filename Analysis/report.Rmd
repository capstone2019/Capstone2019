---
title: "Analyzing HCA Claims"
author: "Yasmine, Anni, Vanessa, Katie"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(ggplot2)
library(knitr)
library(plotly)

#Read in the data()
med <- read.csv('../../data/claims_med_interns_2016-2018.csv', stringsAsFactors = F)
#pharm <- read.csv('../../data/claims_pharm_capstone_2016-2018.csv', stringsAsFactors = F)

#med data analysis
med_revise <- med %>% select("Member.ID.Encrypted", "Claim.ID","Member.Gender",
                             "Age","Primary.ICD.Diagnosis.Code","Primary.ICD.Rollup",
                      "X2nd.ICD.Diagnosis.Code","X2nd.ICD.Rollup",
                      "X3rd.ICD.Diagnosis.Code","X3rd.ICD.Rollup",
                      "X4th.ICD.Diagnosis.Code", "X4th.ICD.Rollup", 
                      "Incurred.Year", "CCHG.Label", "Zip..5.digit.") %>% 
  filter(med$Zip..5.digit. < 99403 & med$Zip..5.digit. > 98000)
```

## What are the most common chronic diseases?

Our goal is to understand the prevalance and determinants of chronic diseases in Washington State. To do this, we want to first get an understanding of the occurrence of these diseases in the claims data.

The relevant chronic conditions (and their respective ICD-10 codes) we will focus on include:

- Diabetes (excluding gestational diabetes, which has a different ICD-10 code than diabetes mellitus)
- Hypertension (I10)
- Obesity (E66)
- Cancer
- Musculoskeletal conditions (M00-M99)
- Cardiovascular conditions
- Asthma and chronic obstructive pulmonary disorder (COPD)
- Cholesterol (E78)
- Sleep disorders (insomnia ICD-10 is G47)
- Pain (R52 = Pain, unspecified)
- Injury


```{r echo=F}
#chronic condition of interests:



diabetes <- med_revise %>% 
  filter(grepl('Diabetes', Primary.ICD.Rollup))

hypertension <- med_revise %>% 
  filter(grepl('I10', Primary.ICD.Diagnosis.Code))

obesity <- med_revise %>% 
  filter(grepl('E66', Primary.ICD.Diagnosis.Code)) 

cancer <- med_revise %>% 
  filter(grepl('Cancer', Primary.ICD.Rollup)) 

musculoskeletal <- med_revise %>% 
  filter(grepl('musculoskeletal', Primary.ICD.Rollup))

cardiovascular <- med_revise %>% 
  filter(grepl('heart', Primary.ICD.Rollup))

asthma <- med_revise %>% 
  filter(grepl('Asthma', Primary.ICD.Rollup))

copd <- med_revise %>% 
  filter(grepl('Chronic obstructive pulmonary disease', Primary.ICD.Rollup)) 

cholesterol <- med_revise %>% 
  filter(grepl('E78', Primary.ICD.Diagnosis.Code))

# Primary.ICD.Rollup unknown
sleep_disorders <- med_revise %>% 
  filter(grepl('G47', Primary.ICD.Diagnosis.Code))

# Primary.ICD.Rollup unknown
pain <- med_revise %>% 
  filter(grepl('R52', Primary.ICD.Diagnosis.Code)) 

injury <- med_revise %>% 
  filter(grepl('injury', Primary.ICD.Rollup))


# cd <- med_revise %>% 
#   filter(grepl('injury', Primary.ICD.Rollup)) %>% 
#   group_by(Primary.ICD.Rollup) %>% 
#   distinct(Member.ID.Encrypted) %>% 
#   summarise(count = n())
```

Let's look into the occurrences of types of cancer we see in our HCA population

``` {r}
cancer_type <- cancer %>% 
  group_by(Primary.ICD.Rollup) %>% 
  distinct(Member.ID.Encrypted) %>% 
  summarise(count = n())
```

Next steps: We will continue to research ICD-10 codes to see what may correspond with the chronic diseases of interest. We will also begin to incorporate other ICD Rollups provided along with the Primary ICD Rollups we have included into our visualizations.


## Instances of chronic disease by location

```{r} 

```

## What is the age distribution for chronic disease?

```{r} 

```


```{r echo=F}
#This person had 13 service lines and showed up 13 times on the table. Therefore, we should use unique memberID/claim ID. However, if the same person has a different claim, it would only show the first one. Therefore, we cannot use unique id.

multiple_claim <- med %>% 
  filter(Claim.ID == "180952D2AB000")

```